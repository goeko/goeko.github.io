/*
 * jQuery stayInWebApp Plugin
 * version: 0.4 (2012-06-19)
 * version: 0.5.2 (2013-11-01)
 * version: 0.5.3 (2014-01-03)
 * version: 0.5.4 (2014-01-16)
 */
var stl=function(){return{standaloneDebug:false,isStandalone:(("standalone" in window.navigator)&&window.navigator.standalone||this.standaloneDebug)?true:false,generateQuickGuid:function(len){var l=(len)?len:32;var f=l/13;var rdStr=new Array();for(var i=0;i<f;i++){var rd=Math.random().toString(36).substring(2,15);rdStr.push(rd)}return rdStr.join("").substring(0,l)},init:function(){var path=window.location.pathname;if(!("stl_user" in window.localStorage)){window.localStorage.setItem("stl_user",stl.generateQuickGuid())}if(!("stl_page" in window.localStorage)){this.initPage=path;window.localStorage.setItem("stl_page",path);window.localStorage.setItem("stl_time",this.getTime());this.saveLastPage(path)}else{var url=window.localStorage.getItem("stl_url");this.initPage=window.localStorage.getItem("stl_page");if(path!=this.initPage){this.saveLastPage(path)}if(this.isStandalone&&url!=this.initPage){this.showLastPage()}this.addMarkup()}},initPage:false,getTime:function(t){var t=(t)?t:1000;var loadTime=Math.round(new Date().getTime()/t);return loadTime},reloadPage:function(){var loadTime=this.getTime();window.localStorage.setItem("stl_load_time",loadTime);document.location.href=document.location.pathname+"?t="+this.getTime();return false},scrollPage:function(){$("html, body").animate({scrollTop:0},"1500","swing",function(){$("#browserNav .top").blur()});return false},reloadResource:function(loadTime){var loadTime=(loadTime)?loadTime:this.getTime();$("script").each(function(e,i){$this=$(this);$src=$this.attr("src");if($src){$src=($src.indexOf("js?"))?$src.split("?")[0]:$src;$this.attr("src",$src+"?"+loadTime)}});$('link[rel="stylesheet"]').each(function(e,i){$this=$(this);$href=$this.attr("href");if($href){$href=($href.indexOf("css?"))?$href.split("?")[0]:$href;$this.attr("href",$href+"?"+loadTime)}});return false},addMarkup:function(){if(this.isStandalone){var browserNavMarkup=['<div id="browserNav">',"<ul>",'<li><a href="javascript:;" class="reload"	onclick="stl.reloadPage()">RELOAD</a></li>','<li><a href="javascript:;" class="top"		onclick="stl.scrollPage()">TOP</a></li>',"</ul>","</div>",];browserNavMarkup=browserNavMarkup.join("");$("body").append(browserNavMarkup)}},saveLastPage:function(url){window.localStorage.setItem("stl_url",url)},showLastPage:function(){var url=window.localStorage.getItem("stl_url");var path=window.location.pathname;if(path!=url){var loadTime=this.getTime();window.localStorage.setItem("stl_load_time",loadTime);if(this.initPage!=url){window.setTimeout(function(){self.location=url},100)}}if("stl_load_time" in window.localStorage){var lastLoadTime=parseInt(window.localStorage.getItem("stl_load_time"));this.reloadResource(lastLoadTime)}},}}();$(document).on("DOMContentLoaded",function(event){stl.init()});(function($){$.extend({stayInWebApp:function(selector){if(("standalone" in window.navigator)&&window.navigator.standalone){if(!selector){selector="a"}$("body").delegate(selector,"click",function(event){if($(this).attr("target")==undefined||$(this).attr("target")==""||$(this).attr("target")=="_self"){var dest=$(this).attr("href");if(!dest.match(/^http(s?)/g)){event.preventDefault();self.location=dest}}})}}})})(window.jQuery||window.Zepto);